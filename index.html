<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>éŠ€æ²³å¥¶ç‰›è¿·å®®æ”¶ç›Š</title>
    <style>
        :root { --gold: #ffd700; --bg: #0b0e14; --panel: #1a1f29; --border: #2d3748; --text: #e2e8f0; --green: #4fd1c5; --blue: #63b3ed; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 1000px; background: var(--panel); padding: 30px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: var(--gold); text-align: center; margin-bottom: 25px; }
        .grid-layout { display: grid; grid-template-columns: 1fr 1.2fr; gap: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.85rem; }
        th { background: #2d3748; color: var(--gold); padding: 10px; text-align: left; }
        td { padding: 8px 10px; border-bottom: 1px solid var(--border); }
        
        /* è¡¨æ ¼å¯¬åº¦æ¯”ä¾‹ */
        .config-table th:nth-child(1), .config-table td:nth-child(1) { width: 15%; }
        .config-table th:nth-child(2), .config-table td:nth-child(2) { width: 15%; }
        .config-table th:nth-child(3), .config-table td:nth-child(3) { width: 20%; }
        .config-table th:nth-child(4), .config-table td:nth-child(4) { width: 20%; }

        select, input { background: #0b0e14; color: var(--green); border: 1px solid var(--gold); padding: 5px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .token-qty { color: var(--green); font-weight: bold; text-align: center; }
        .other-val { color: var(--blue); font-weight: bold; text-align: right; }
        .btn-fetch { background: var(--gold); color: #1a202c; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; border: none; margin-bottom: 15px; transition: 0.2s; }
        .btn-fetch:hover { background: #e6c200; transform: translateY(-1px); }
        .status { text-align: center; font-size: 0.8rem; color: #718096; margin-bottom: 10px; min-height: 1.2em; }
        .rev-table td:first-child { text-align: left; }
        .rev-table th:nth-child(2), .rev-table td:nth-child(2) { text-align: center; }
        .rev-table th:nth-child(3), .rev-table td:nth-child(3) { text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h2>éŠ€æ²³å¥¶ç‰›è¿·å®®æ”¶ç›Š</h2>
    
    <div id="status-msg" class="status">æç¤ºï¼šè«‹é»æ“Šæ›´æ–°æŒ‰éˆ•åŒæ­¥å³æ™‚å¸‚å ´åƒ¹æ ¼</div>
    <button class="btn-fetch" onclick="updatePrices()">ğŸ”„ æ›´æ–° API å³æ™‚åƒ¹æ ¼ (Mooket é‚è¼¯å„ªåŒ–ç‰ˆ)</button>

    <div class="grid-layout">
        <div>
            <table class="config-table">
                <thead>
                    <tr><th>é …ç›®</th><th>ç­‰ç´š</th><th>æ•¸é‡</th><th>å–®åƒ¹</th></tr>
                </thead>
                <tbody id="config-body"></tbody>
                <tr style="background: rgba(99, 179, 237, 0.05);">
                    <td colspan="2" style="color: var(--blue);">ç²¾ç…‰ç¢ç‰‡å¸‚å ´ä¼°åƒ¹</td>
                    <td colspan="2"><input type="number" id="refining-shard-price" value="2500000" oninput="calculate()"></td>
                </tr>
                <tr style="background: rgba(255, 215, 0, 0.05);">
                    <td colspan="2" style="color: var(--gold);">ç´«å¤šæ‹‰ä¹‹ç›’ä¼°åƒ¹</td>
                    <td colspan="2"><input type="number" id="box-price" value="900000" oninput="calculate()"></td>
                </tr>
            </table>
            <div id="total-cost-display" style="text-align: right; font-weight: bold; color: var(--gold); font-size: 1.1rem;">
                ç¸½é ä¼°æˆæœ¬ï¼š0
            </div>
        </div>

        <div>
            <table class="rev-table">
                <thead>
                    <tr>
                        <th>æ¨“å±¤é€²åº¦</th>
                        <th>ä»£å¹£æ•¸é‡</th>
                        <th>å…¶ä»–æ”¶ç›Š (ä¸å«ä»£å¹£)</th>
                    </tr>
                </thead>
                <tbody id="revenue-body"></tbody>
            </table>
            <div style="font-size: 0.75rem; color: #718096; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px;">
                * <b>ä»£å¹£ç´¯è¨ˆ</b>ï¼šåŒ…å«å‡ºå£å›ºå®šçå‹µåŠæˆ¿é–“æœŸæœ›ç”¢å‡ºã€‚<br>
                * <b>å…¶ä»–æ”¶ç›Š</b>ï¼šåƒ…è¨ˆç®—ç´«å¤šæ‹‰ä¹‹ç›’èˆ‡ç¬¬ 6 å±¤èµ·çš„ç²¾ç…‰ç¢ç‰‡ã€‚
            </div>
        </div>
    </div>
</div>

<script>
    const items = [
        { key: 'torch', name: 'ç«æŠŠ', qty: 100, level: 'expert', hrid_base: 'torch' },
        { key: 'curtain', name: 'æ–—ç¯·', qty: 4, level: 'expert', hrid_base: 'curtain' },
        { key: 'beacon', name: 'ä¿¡æ¨™', qty: 5, level: 'expert', hrid_base: 'beacon' },
        { key: 'tea', name: 'èŒ¶è‘‰ç®±', qty: 1, level: 'expert', hrid_base: 'tea_box' },
        { key: 'coffee', name: 'å’–å•¡ç®±', qty: 1, level: 'expert', hrid_base: 'coffee_box' },
        { key: 'food', name: 'é£Ÿç‰©ç®±', qty: 1, level: 'expert', hrid_base: 'food_box' }
    ];

    function init() {
        const body = document.getElementById('config-body');
        body.innerHTML = items.map((item, i) => `
            <tr>
                <td>${item.name}</td>
                <td>
                    <select id="lvl-${i}" onchange="calculate()">
                        <option value="basic">åŸºç¤</option>
                        <option value="advanced">é€²éš</option>
                        <option value="expert" selected>å°ˆå®¶</option>
                    </select>
                </td>
                <td><input type="number" id="qty-${i}" value="${item.qty}" oninput="calculate()"></td>
                <td><input type="number" id="prc-${i}" value="0" oninput="calculate()"></td>
            </tr>
        `).join('');
        calculate();
    }

    function calculate() {
        let totalCost = 0;
        items.forEach((_, i) => {
            const q = parseFloat(document.getElementById(`qty-${i}`).value) || 0;
            const p = parseFloat(document.getElementById(`prc-${i}`).value) || 0;
            totalCost += q * p;
        });
        document.getElementById('total-cost-display').innerText = `ç¸½é ä¼°æˆæœ¬ï¼š${Math.round(totalCost).toLocaleString()}`;

        const revBody = document.getElementById('revenue-body');
        revBody.innerHTML = '';
        const boxVal = parseFloat(document.getElementById('box-price').value) || 0;
        const shardVal = parseFloat(document.getElementById('refining-shard-price').value) || 0;

        let accTokens = 0;
        let accOtherRev = 0;

        for (let l = 1; l <= 10; l++) {
            const layerTokens = (5 * l) + (l * 0.5); 
            accTokens += layerTokens;
            let layerOtherRev = (l * 0.12) * boxVal;
            if (l >= 6) {
                const chestQty = (l - 4) / 2;
                const shardQty = chestQty * 1.25;
                layerOtherRev += (shardQty * shardVal);
            }
            accOtherRev += layerOtherRev;

            revBody.innerHTML += `
                <tr>
                    <td>åˆ°ç¬¬ ${l} å±¤å‡ºå£ç´¯è¨ˆ</td>
                    <td class="token-qty">${Math.round(accTokens).toLocaleString()}</td>
                    <td class="other-val">${Math.round(accOtherRev).toLocaleString()}</td>
                </tr>
            `;
        }
    }

async function updatePrices() {
    const status = document.getElementById('status-msg');
    status.innerText = "â³ æ­£åœ¨å¾è‡ªå‹•åŒ–å€‰åº«è®€å–æœ€æ–°å–®åƒ¹...";

    try {
        // è®€å–å‰›ç”Ÿæˆçš„æœ¬åœ° data.jsonï¼Œä¸¦åŠ ä¸Šæ™‚é–“æˆ³è¨˜å¼·åˆ¶åˆ·æ–°å¿«å–
        const res = await fetch('./data.json?t=' + Date.now());
        
        if (!res.ok) throw new Error("æ‰¾ä¸åˆ°æ•¸æ“šæª”æ¡ˆï¼Œè«‹ç¢ºèª data.json æ˜¯å¦å­˜åœ¨");

        const data = await res.json();
        const market = data.marketplace;

        if (!market) throw new Error("æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º");

        items.forEach((item, i) => {
            const lvl = document.getElementById(`lvl-${i}`).value;
            const hrid = `/items/${lvl}_${item.hrid_base}`;
            
            // åœ¨ marketplace é™£åˆ—ä¸­å°‹æ‰¾å°æ‡‰çš„ç‰©å“
            const found = market.find(m => m.itemHrid === hrid);
            
            if (found) {
                // è‡ªå‹•å¡«å…¥æœ€æ–°çš„ ask åƒ¹æ ¼
                document.getElementById(`prc-${i}`).value = found.ask;
            }
        });

        status.innerText = "âœ… åŒæ­¥æˆåŠŸï¼(æ•¸æ“šæ¯ 30 åˆ†é˜è‡ªå‹•æ›´æ–°)";
        status.style.color = "#4fd1c5";
        
        // å‘¼å«è¨ˆç®—å‡½æ•¸æ›´æ–°ç¸½æˆæœ¬èˆ‡æ”¶ç›Š
        calculate();
        
    } catch (e) {
        console.error(e);
        status.innerText = "âŒ åŒæ­¥å¤±æ•—ï¼š" + e.message;
        status.style.color = "#ff4d4d";
    }
}

    window.onload = init;
</script>
</body>
</html>


